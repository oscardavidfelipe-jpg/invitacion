<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Confirmar asistencia - Pablo</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{--accent:#b7955a;--bg:#faf7f6}
body{margin:0;font-family:Inter,Arial;background:var(--bg);color:#222}
.container{max-width:820px;margin:60px auto;padding:20px}
.card{background:#fff;border-radius:12px;padding:22px;box-shadow:0 12px 30px rgba(0,0,0,0.06)}
label{display:block;margin-top:12px;font-weight:600}
input,select,textarea{width:100%;padding:12px;border-radius:8px;border:1px solid #e9e4df;margin-top:6px}
.actions{margin-top:14px;display:flex;gap:12px}
.btn{background:var(--accent);color:white;padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn.secondary{background:#e9e4df;color:#333}
.note{color:#666;margin-top:10px;font-size:14px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>Confirmá tu asistencia</h2>
    <p class="note">Completá el formulario — tus respuestas podrán ser exportadas por el administrador.</p>
    <form id="rsvp">
      <label>Nombre completo</label>
      <input id="nombre" required>

      <label>Email</label>
      <input id="email" type="email" required>

      <label>¿Asistirá?</label>
      <select id="asiste" required>
        <option value="">Seleccioná</option>
        <option value="Sí">Sí</option>
        <option value="No">No</option>
      </select>

      <label>Cantidad de acompañantes</label>
      <input id="acompanantes" type="number" min="0" value="0">

      <label>Restricciones alimentarias (ej: sin gluten)</label>
      <input id="restricciones" placeholder="sin gluten, vegetariano...">

      <label>Sugerencia musical</label>
      <input id="musica" placeholder="Artista o canción">

      <div class="actions">
        <button class="btn" type="button" onclick="enviar()">Confirmar asistencia</button>
        <button class="btn secondary" type="button" onclick="limpiar()">Limpiar</button>
      </div>
      <p id="msg" class="note" style="display:none"></p>
    </form>

    <p class="note">Si configurás un endpoint (Google Apps Script) se enviarán también al servidor; si no, se guardan localmente.</p>
  </div>
</div>

<script>
// CONFIG: si tenés Apps Script, poné la URL aquí
const CONFIG = { APP_SCRIPT_ENDPOINT: "REPLACE_WITH_YOUR_APPSCRIPT_URL" };

function show(msg,ok=true){
  const el = document.getElementById('msg');
  el.style.display='block';
  el.style.color = ok ? '#2a7a2a' : '#a23a3a';
  el.textContent = msg;
  setTimeout(()=> el.style.display='none',6000);
}

function collect(){
  return {
    nombre: document.getElementById('nombre').value.trim(),
    email: document.getElementById('email').value.trim(),
    asiste: document.getElementById('asiste').value,
    acompanantes: document.getElementById('acompanantes').value,
    restricciones: document.getElementById('restricciones').value.trim(),
    musica: document.getElementById('musica').value.trim(),
    ts: new Date().toISOString()
  };
}

function validar(d){
  if(!d.nombre) return "Completa el nombre.";
  if(!d.email) return "Email inválido.";
  if(!d.asiste) return "Seleccioná si asistirás.";
  return null;
}

function saveLocal(data){
  const key='invitaciones_pablo_asist';
  let arr = JSON.parse(localStorage.getItem(key)||'[]');
  arr.push(data);
  localStorage.setItem(key, JSON.stringify(arr));
}

function enviar(){
  const data = collect();
  const err = validar(data);
  if(err){ show(err,false); return; }

  if(CONFIG.APP_SCRIPT_ENDPOINT && !CONFIG.APP_SCRIPT_ENDPOINT.includes('REPLACE_WITH')){
    fetch(CONFIG.APP_SCRIPT_ENDPOINT, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)})
    .then(r=>{ if(r.ok){ show('Confirmación enviada. ¡Gracias!'); document.getElementById('rsvp').reset(); } else { show('Error al enviar; guardado localmente.',false); saveLocal(data); } })
    .catch(e=>{ console.error(e); show('Error de conexión; guardado localmente.',false); saveLocal(data); });
  } else {
    saveLocal(data);
    show('Confirmación guardada localmente. Gracias!');
    document.getElementById('rsvp').reset();
  }
}

function limpiar(){ document.getElementById('rsvp').reset(); show('Formulario limpiado.',true); }
</script>
</body>
</html>
